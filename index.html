<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper UI</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #444;
        }
        form {
            display: flex;
            flex-direction: column;
        }
        .form-group {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="checkbox"] {
            margin-right: 10px;
        }
        .description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-weight: normal;
        }
        .form-group-checkbox {
            display: flex;
            align-items: center;
        }
        .form-group-checkbox label {
            font-weight: normal;
            display: flex;
            align-items: center;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .word-timestamps-options {
            padding-left: 20px;
            border-left: 3px solid #4CAF50;
            margin-top: 10px;
        }
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        #output {
            position: relative;
        }
        #copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #007bff;
        }
        #copy-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Whisper Command Line Interface</h1>
        <form id="whisper-form">

            <div class="form-group">
                <label for="audio">Audio File(s)</label>
                <input type="file" id="audio" name="audio" multiple>
                <p class="description">Audio file(s) to transcribe.</p>
            </div>

            <div class="form-group">
                <label for="model">Model</label>
                <input type="text" id="model" name="model" value="turbo">
                <p class="description">Name of the Whisper model to use (default: turbo).</p>
            </div>

            <div class="form-group">
                <label for="model_dir">Model Directory</label>
                <input type="text" id="model_dir" name="model_dir" placeholder="~/.cache/whisper">
                <p class="description">The path to save model files; uses ~/.cache/whisper by default.</p>
            </div>

            <div class="form-group">
                <label for="device">Device</label>
                <input type="text" id="device" name="device" value="cpu">
                <p class="description">Device to use for PyTorch inference (default: cpu).</p>
            </div>

            <div class="form-group">
                <label for="output_dir">Output Directory</label>
                <input type="text" id="output_dir" name="output_dir" value=".">
                <p class="description">Directory to save the outputs (default: .).</p>
            </div>

            <div class="form-group">
                <label for="output_format">Output Format</label>
                <select id="output_format" name="output_format">
                    <option value="all">all</option>
                    <option value="txt">txt</option>
                    <option value="vtt">vtt</option>
                    <option value="srt">srt</option>
                    <option value="tsv">tsv</option>
                    <option value="json">json</option>
                </select>
                <p class="description">Format of the output file; if not specified, all available formats will be produced (default: all).</p>
            </div>

            <div class="form-group">
                <label for="task">Task</label>
                <select id="task" name="task">
                    <option value="transcribe">transcribe</option>
                    <option value="translate">translate</option>
                </select>
                <p class="description">Whether to perform X->X speech recognition ('transcribe') or X->English translation ('translate') (default: transcribe).</p>
            </div>

            <div class="form-group">
                <label for="language">Language</label>
                <select id="language" name="language">
                    <option value="">Detect Language</option>
                    <option value="af">Afrikaans</option>
                    <option value="sq">Albanian</option>
                    <option value="am">Amharic</option>
                    <option value="ar">Arabic</option>
                    <option value="hy">Armenian</option>
                    <option value="as">Assamese</option>
                    <option value="az">Azerbaijani</option>
                    <option value="ba">Bashkir</option>
                    <option value="eu">Basque</option>
                    <option value="be">Belarusian</option>
                    <option value="bn">Bengali</option>
                    <option value="bs">Bosnian</option>
                    <option value="br">Breton</option>
                    <option value="bg">Bulgarian</option>
                    <option value="my">Burmese</option>
                    <option value="yue">Cantonese</option>
                    <option value="es">Castilian</option>
                    <option value="ca">Catalan</option>
                    <option value="zh">Chinese</option>
                    <option value="hr">Croatian</option>
                    <option value="cs">Czech</option>
                    <option value="da">Danish</option>
                    <option value="nl">Dutch</option>
                    <option value="en">English</option>
                    <option value="et">Estonian</option>
                    <option value="fo">Faroese</option>
                    <option value="fi">Finnish</option>
                    <option value="nl">Flemish</option>
                    <option value="fr">French</option>
                    <option value="gl">Galician</option>
                    <option value="ka">Georgian</option>
                    <option value="de">German</option>
                    <option value="el">Greek</option>
                    <option value="gu">Gujarati</option>
                    <option value="ht">Haitian</option>
                    <option value="ht">Haitian Creole</option>
                    <option value="ha">Hausa</option>
                    <option value="haw">Hawaiian</option>
                    <option value="he">Hebrew</option>
                    <option value="hi">Hindi</option>
                    <option value="hu">Hungarian</option>
                    <option value="is">Icelandic</option>
                    <option value="id">Indonesian</option>
                    <option value="it">Italian</option>
                    <option value="ja">Japanese</option>
                    <option value="jw">Javanese</option>
                    <option value="kn">Kannada</option>
                    <option value="kk">Kazakh</option>
                    <option value="km">Khmer</option>
                    <option value="ko">Korean</option>
                    <option value="lo">Lao</option>
                    <option value="la">Latin</option>
                    <option value="lv">Latvian</option>
                    <option value="lb">Luxembourgish</option>
                    <option value="ln">Lingala</option>
                    <option value="lt">Lithuanian</option>
                    <option value="mk">Macedonian</option>
                    <option value="mg">Malagasy</option>
                    <option value="ms">Malay</option>
                    <option value="ml">Malayalam</option>
                    <option value="mt">Maltese</option>
                    <option value="mi">Maori</option>
                    <option value="mr">Marathi</option>
                    <option value="ro">Moldavian</option>
                    <option value="ro">Moldovan</option>
                    <option value="mn">Mongolian</option>
                    <option value="ne">Nepali</option>
                    <option value="no">Norwegian</option>
                    <option value="nn">Nynorsk</option>
                    <option value="oc">Occitan</option>
                    <option value="pa">Panjabi</option>
                    <option value="ps">Pashto</option>
                    <option value="fa">Persian</option>
                    <option value="pl">Polish</option>
                    <option value="pt">Portuguese</option>
                    <option value="ro">Romanian</option>
                    <option value="ru">Russian</option>
                    <option value="sa">Sanskrit</option>
                    <option value="sr">Serbian</option>
                    <option value="sn">Shona</option>
                    <option value="sd">Sindhi</option>
                    <option value="si">Sinhala</option>
                    <option value="sk">Slovak</option>
                    <option value="sl">Slovenian</option>
                    <option value="so">Somali</option>
                    <option value="es">Spanish</option>
                    <option value="su">Sundanese</option>
                    <option value="sw">Swahili</option>
                    <option value="sv">Swedish</option>
                    <option value="tl">Tagalog</option>
                    <option value="tg">Tajik</option>
                    <option value="ta">Tamil</option>
                    <option value="tt">Tatar</option>
                    <option value="te">Telugu</option>
                    <option value="th">Thai</option>
                    <option value="bo">Tibetan</option>
                    <option value="tr">Turkish</option>
                    <option value="tk">Turkmen</option>
                    <option value="uk">Ukrainian</option>
                    <option value="ur">Urdu</option>
                    <option value="uz">Uzbek</option>
                    <option value="vi">Vietnamese</option>
                    <option value="cy">Welsh</option>
                    <option value="yi">Yiddish</option>
                    <option value="yo">Yoruba</option>
                </select>
                <p class="description">Language spoken in the audio, specify None to perform language detection (default: None).</p>
            </div>

            <div class="form-group">
                <label for="temperature">Temperature</label>
                <input type="number" id="temperature" name="temperature" value="0" step="0.1">
                <p class="description">Temperature to use for sampling (default: 0).</p>
            </div>

            <div class="form-group">
                <label for="best_of">Best Of</label>
                <input type="number" id="best_of" name="best_of" value="5">
                <p class="description">Number of candidates when sampling with non-zero temperature (default: 5).</p>
            </div>

            <div class="form-group">
                <label for="beam_size">Beam Size</label>
                <input type="number" id="beam_size" name="beam_size" value="5">
                <p class="description">Number of beams in beam search, only applicable when temperature is zero (default: 5).</p>
            </div>

            <div class="form-group">
                <label for="patience">Patience</label>
                <input type="number" id="patience" name="patience" step="0.1" placeholder="None">
                <p class="description">Optional patience value to use in beam decoding (default: None).</p>
            </div>

            <div class="form-group">
                <label for="length_penalty">Length Penalty</label>
                <input type="number" id="length_penalty" name="length_penalty" step="0.1" placeholder="None">
                <p class="description">Optional token length penalty coefficient (default: None).</p>
            </div>

            <div class="form-group">
                <label for="suppress_tokens">Suppress Tokens</label>
                <input type="text" id="suppress_tokens" name="suppress_tokens" value="-1">
                <p class="description">Comma-separated list of token ids to suppress during sampling; '-1' will suppress most special characters except common punctuations (default: -1).</p>
            </div>

            <div class="form-group">
                <label for="initial_prompt">Initial Prompt</label>
                <textarea id="initial_prompt" name="initial_prompt" rows="3" placeholder="None"></textarea>
                <p class="description">Optional text to provide as a prompt for the first window (default: None).</p>
            </div>

            <div class="form-group form-group-checkbox">
                <label for="carry_initial_prompt">
                    <input type="checkbox" id="carry_initial_prompt" name="carry_initial_prompt">
                    Carry Initial Prompt
                    <span class="description">(If True, prepend initial_prompt to every internal decode() call.)</span>
                </label>
            </div>

            <div class="form-group form-group-checkbox">
                 <label for="condition_on_previous_text">
                    <input type="checkbox" id="condition_on_previous_text" name="condition_on_previous_text" checked>
                    Condition on Previous Text
                    <span class="description">(If True, provide the previous output of the model as a prompt for the next window.)</span>
                </label>
            </div>

            <div class="form-group form-group-checkbox">
                <label for="fp16">
                    <input type="checkbox" id="fp16" name="fp16" checked>
                    FP16
                    <span class="description">(Whether to perform inference in fp16; True by default.)</span>
                </label>
            </div>

            <div class="form-group">
                <label for="temperature_increment_on_fallback">Temperature Increment on Fallback</label>
                <input type="number" id="temperature_increment_on_fallback" name="temperature_increment_on_fallback" value="0.2" step="0.1">
                <p class="description">Temperature to increase when falling back when the decoding fails to meet either of the thresholds below (default: 0.2).</p>
            </div>

            <div class="form-group">
                <label for="compression_ratio_threshold">Compression Ratio Threshold</label>
                <input type="number" id="compression_ratio_threshold" name="compression_ratio_threshold" value="2.4" step="0.1">
                <p class="description">If the gzip compression ratio is higher than this value, treat the decoding as failed (default: 2.4).</p>
            </div>

            <div class="form-group">
                <label for="logprob_threshold">Logprob Threshold</label>
                <input type="number" id="logprob_threshold" name="logprob_threshold" value="-1.0" step="0.1">
                <p class="description">If the average log probability is lower than this value, treat the decoding as failed (default: -1.0).</p>
            </div>

            <div class="form-group">
                <label for="no_speech_threshold">No Speech Threshold</label>
                <input type="number" id="no_speech_threshold" name="no_speech_threshold" value="0.6" step="0.1">
                <p class="description">If the probability of the &lt;|nospeech|&gt; token is higher than this value AND the decoding has failed due to logprob_threshold, consider the segment as silence (default: 0.6).</p>
            </div>

            <div class="form-group">
                <div class="form-group-checkbox">
                    <label for="word_timestamps">
                        <input type="checkbox" id="word_timestamps" name="word_timestamps">
                        Word Timestamps
                        <span class="description">(Experimental) extract word-level timestamps and refine the results based on them.</span>
                    </label>
                </div>

                <div id="word-timestamps-options" class="word-timestamps-options disabled">

                    <div class="form-group">
                        <label for="prepend_punctuations">Prepend Punctuations</label>
                        <input type="text" id="prepend_punctuations" name="prepend_punctuations" value="'“¿([{-)">
                        <p class="description">If word_timestamps is True, merge these punctuation symbols with the next word.</p>
                    </div>

                    <div class="form-group">
                        <label for="append_punctuations">Append Punctuations</label>
                        <input type="text" id="append_punctuations" name="append_punctuations" value="'.。,，!！?？:：”)]}、">
                        <p class="description">If word_timestamps is True, merge these punctuation symbols with the previous word.</p>
                    </div>

                    <div class="form-group form-group-checkbox">
                        <label for="highlight_words">
                            <input type="checkbox" id="highlight_words" name="highlight_words">
                            Highlight Words
                             <span class="description">(Underline each word as it is spoken in srt and vtt.)</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="max_line_width">Max Line Width</label>
                        <input type="number" id="max_line_width" name="max_line_width" placeholder="None">
                        <p class="description">The maximum number of characters in a line before breaking the line.</p>
                    </div>

                    <div class="form-group">
                        <label for="max_line_count">Max Line Count</label>
                        <input type="number" id="max_line_count" name="max_line_count" placeholder="None">
                        <p class="description">The maximum number of lines in a segment.</p>
                    </div>

                    <div class="form-group">
                        <label for="max_words_per_line">Max Words Per Line</label>
                        <input type="number" id="max_words_per_line" name="max_words_per_line" placeholder="None">
                        <p class="description">The maximum number of words in a segment.</p>
                    </div>

                    <div class="form-group">
                        <label for="hallucination_silence_threshold">Hallucination Silence Threshold</label>
                        <input type="number" id="hallucination_silence_threshold" name="hallucination_silence_threshold" step="0.1" placeholder="None">
                        <p class="description">Skip silent periods longer than this threshold (in seconds) when a possible hallucination is detected.</p>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="threads">Threads</label>
                <input type="number" id="threads" name="threads" value="0">
                <p class="description">Number of threads used by torch for CPU inference (default: 0).</p>
            </div>

            <div class="form-group">
                <label for="clip_timestamps">Clip Timestamps</label>
                <input type="text" id="clip_timestamps" name="clip_timestamps" value="0">
                <p class="description">Comma-separated list start,end,start,end,... timestamps (in seconds) of clips to process (default: 0).</p>
            </div>

            <div class="form-group form-group-checkbox">
                <label for="verbose">
                    <input type="checkbox" id="verbose" name="verbose" checked>
                    Verbose
                    <span class="description">(Whether to print out the progress and debug messages (default: True).)</span>
                </label>
            </div>


            <button type="submit">Generate Command</button>
        </form>

        <div id="output" class="form-group" style="display: none;">
            <label>Generated Command</label>
            <button id="copy-button">Copy</button>
            <textarea id="generated-command" rows="5" readonly></textarea>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const wordTimestampsCheckbox = document.getElementById('word_timestamps');
            const wordTimestampsOptions = document.getElementById('word-timestamps-options');

            function toggleWordTimestampOptions() {
                const isDisabled = !wordTimestampsCheckbox.checked;
                wordTimestampsOptions.classList.toggle('disabled', isDisabled);
                wordTimestampsOptions.querySelectorAll('input, select, textarea').forEach(el => el.disabled = isDisabled);
            }

            wordTimestampsCheckbox.addEventListener('change', toggleWordTimestampOptions);
            toggleWordTimestampOptions();

            document.getElementById('whisper-form').addEventListener('submit', function (e) {
                e.preventDefault();
                let command = 'whisper';

                const audioFiles = document.getElementById('audio').files;
                if (audioFiles.length > 0) {
                    for (const file of audioFiles) {
                        command += ` "${file.name}"`;
                    }
                } else {
                    command += ' audio.mp3'; // Placeholder
                }

                const formElements = this.elements;
                for (let i = 0; i < formElements.length; i++) {
                    const element = formElements[i];
                    const key = element.name;

                    if (!key || element.type === 'submit' || element.type === 'file' || element.disabled) {
                        continue;
                    }

                    if (element.type === 'checkbox') {
                        // The whisper CLI expects boolean-like flags to be passed with a value,
                        // e.g., --verbose True or --verbose False.
                        // This logic adds the flag only if its value is different from the default,
                        // to generate a minimal command.
                        if (element.checked !== element.defaultChecked) {
                            command += ` --${key} ${element.checked}`;
                        }
                    } else {
                        const value = element.value;
                        const defaultValue = element.defaultValue;
                        if (value !== defaultValue && value) {
                            command += ` --${key} "${value}"`;
                        }
                    }
                }

                document.getElementById('generated-command').value = command.trim();
                document.getElementById('output').style.display = 'block';
            });

            document.getElementById('copy-button').addEventListener('click', function() {
                const commandText = document.getElementById('generated-command');
                commandText.select();
                document.execCommand('copy');
                this.textContent = 'Copied!';
                setTimeout(() => {
                    this.textContent = 'Copy';
                }, 2000);
            });
        });
    </script>
</body>
</html>
